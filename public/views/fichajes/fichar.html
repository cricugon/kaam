<div class="row g-4" id="vistaFichajesFichar">
  <div class="col-lg-7">
    <div class="card h-100 shadow-sm">
      <div class="card-header d-flex align-items-center justify-content-between">
        <div>
          <p class="text-uppercase text-muted small mb-1">Registro de jornada</p>
          <h4 class="mb-0" id="tituloDiaFichajes">—</h4>
        </div>
        <div class="text-end">
          <small class="text-muted d-block">Tiempo trabajado hoy</small>
          <span class="badge bg-info fs-6" id="totalDiaFichajes">00:00:00</span>
        </div>
      </div>

      <div class="card-body">
        <!-- Estado -->
        <div class="card mb-4" id="estadoFichajeCard">
          <div class="card-body d-flex flex-column flex-md-row align-items-center gap-3">
            <div class="flex-grow-1">
              <p class="text-muted mb-1">Estado actual</p>
              <h3 class="mb-0" id="estadoFichajeEtiqueta">Sin fichaje activo</h3>
              <small class="text-muted" id="estadoFichajeDetalle">Pulsa “Iniciar fichaje” para comenzar tu jornada.</small>
            </div>
            <div class="d-flex flex-column flex-sm-row gap-2">
              <div class="dropdown w-100 w-sm-auto">
                <button class="btn btn-primary btn-lg dropdown-toggle w-100" id="btnToggleFichaje" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg class="icon me-2"><use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-media-play"></use></svg>
                  Iniciar fichaje
                </button>
                <ul class="dropdown-menu" id="dropdownProyectosFichaje" aria-labelledby="btnToggleFichaje">
                  <li><span class="dropdown-item text-muted">Cargando proyectos...</span></li>
                </ul>
                <ul class="dropdown-menu d-none" id="dropdownPausasFichaje" aria-labelledby="btnToggleFichaje">
                  <!-- se rellena desde JS -->
                </ul>

              </div>
              <button class="btn btn-outline-danger btn-lg d-none" id="btnStopFichaje">
                <svg class="icon me-2"><use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-media-stop"></use></svg>
                Parar
              </button>
            </div>
          </div>
        </div>

        

        <!-- Form con fecha, ubicación oculta y mapa -->
        <form id="formNuevoFichaje" class="row g-3">
          <input type="hidden" name="descripcion" id="descripcionSeleccionada" value="Trabajo">
          

          <!-- Campos ocultos de coordenadas -->
          <input type="hidden" name="coord_latitud">
          <input type="hidden" name="coord_longitud">

          <!-- Mapa solo lectura -->
          <div class="col-12">
            <label class="form-label d-flex justify-content-between">
              <span>Ubicación actual</span>
              <button class="btn btn-link btn-sm p-0" type="button" id="btnCapturarUbicacion">Refrescar ubicación</button>
            </label>
            <div id="mapaFichaje" style="width: 100%; height: 260px; border-radius: 0.75rem; overflow: hidden; background: #f5f7fb;">
              <p class="text-center text-muted py-5 mb-0">Obteniendo ubicación...</p>
            </div>
          </div>

          <div class="col-12">
            <div class="d-flex justify-content-end gap-2">
              <button class="btn btn-light" type="reset" id="btnResetFichaje">Limpiar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Columna derecha: actividad reciente -->
  <div class="col-lg-5">
    <div class="card h-100 shadow-sm">
      <div class="card-header d-flex align-items-center justify-content-between">
        <div>
          <h6 class="mb-0">Actividad reciente</h6>
          <small class="text-muted" id="subtituloActividad">Últimos 10 fichajes</small>
        </div>
        <button class="btn btn-sm btn-link text-decoration-none" id="btnRefrescarActividad">
          <svg class="icon me-1"><use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-reload"></use></svg>
          Actualizar
        </button>
      </div>
      <div class="card-body">
        <div class="fichajes-resumen-actividad mb-3" id="resumenActividadActual">
          <p class="text-muted mb-0">Empieza a fichar para ver tu actividad más reciente aquí.</p>
        </div>
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead>
              <tr>
                <th>Tipo</th>
                <th>Inicio</th>
                <th>Fin</th>
                <th>Tiempo</th>
                <th>Cliente / Obra</th>
              </tr>
            </thead>
            <tbody id="actividadRecienteBody">
              <tr>
                <td colspan="5" class="text-center text-muted py-4">Todavía no hay registros</td>
              </tr>
            </tbody>
          </table>
        </div>
        <small class="text-muted d-block mt-3">Los fichajes se muestran ordenados de más reciente a más antiguo.</small>
      </div>
    </div>
  </div>
</div>
